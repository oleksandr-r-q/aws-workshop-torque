spec_version: 2-preview
description: All in one deployment of our promotions manager


inputs:
  PORT:
    type: numeric
    display-style: normal
    default: 3000
  API_PORT:
    type: numeric
    display-style: normal
    default: 3001
  AWS_INSTANCE_TYPE:
    type: string
    display-style: normal
    default: "t3a.micro"
  RELEASE_NUMBER:
    type: string
    display-style: normal
    default: none
  API_BUILD_NUMBER:
    type: string
    display-style: normal
    default: none
  DB_USERNAME:
    type: string
    display-style: normal
    default: adminuser
  DB_PASSWORD: 
    type: string
    display-style: normal
    description: please set the master database password
    default: Welcome1234567+
  AWS_REGION:
    type: string
    display-style: normal
    default: us-west-2
  aws_s3_bucket:
    type: string
    display-style: normal
    default: artifact-repo-promotionapp-oleksandr
  Environment:
    type: string
    display-style: normal
    default: test

grains:
  promotions-manager-ui:
    kind: helm
    spec:
      source:
        path: https://github.com/oleksandr-r-q/aws-workshop-torque.git//helm/promotions-manager-test1
      host:
        cloud-account: AWS
        compute-service: eks-torque-demo-oleksandrr1
      inputs:
        - env.SANDBOX_ID: '{{ sandboxid | downcase }}'
        - env.API_PORT: '{{.inputs.API_PORT}}'
        - env.RELEASE_NUMBER: '{{.inputs.RELEASE_NUMBER}}'
        - env.API_BUILD_NUMBER: '{{.inputs.API_BUILD_NUMBER}}'
        - env.API_HOST: localhost


outputs:
  url_please_wait_15_minutes:
    value: 'http://promotions-manager.testquali.click'
  # instance_url_please_wait_15_minutes:
  #   value: 'http://ec2-54-189-145-155.us-west-2.compute.amazonaws.com:30000'

